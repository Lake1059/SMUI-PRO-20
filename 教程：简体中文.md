# SMUI PRO 20 教程和技术信息 简体中文
产品正在测试期间，此页内容以最终设计标准为准，如与实际不符请谅解

## 产品概述
SMUI PRO 20 （以下简称 SMUI）是由我独立开发的星露谷物语模组管理器，这是第三代产品，项目始于 2019 年 8 月。它支持所有类型的 MOD 并且不仅仅是 MOD，甚至还能搞点其他的。其核心部分是安装命令，程序通过读取用户编写的安装命令来实现基础的安装和卸载。通过创建一个整合包，就像现实中的一个仓库一样以非常有序的方式存储 MOD。  

注意：如果你正在使用传统方法安装和管理 MOD，你必须将你所有的 MOD 全部转移到 SMUI 使用的整合包中并为它们配置安装命令，这需要花点时间。要使 SMUI 正常发挥作用，你必须这么做，否则 SMUI 就失去其本身的设计意义了。

环境 | 需求 |
:--- | :---
**Windows**|**Windows 10、8.1、8**，在 Win7 上有显示问题
**.NET**|**[.NET Framework 4.8](https://dotnet.microsoft.com/download/dotnet-framework/net48)**  
**CPU**|i5-8400 或者 R3 2300X 及更高性能
**RAM**|2400 MHz 及以上频率的双通道内存条
**SSD**|PCI-E 3.0 及以上速度接口的固态硬盘

## 基本操作和概念
### 开始使用
首次启动，会自动弹出设置窗口，你需要填写你的游戏路径和整合包路径  
要创建新整合包或者升级上一代产品的整合包，请从开始菜单运行应用程序：Package Tool V3

请把你的游戏和整合包全部放在固态硬盘，在机械硬盘上 SMUI 的性能会大打折扣  
因为 SMUI 需要极高的硬盘响应速度和瞬间读取访问

整合包请放在你方便访问的地方，比如说 C 盘根目录  
整合包相当于 SMUI 的巨型数据库，对于高强度使用且精通 SMUI 的用户来说是需要经常访问的

### 主界面分布
在主界面左侧区域是分类栏、中间区域是MOD列表、右侧区域是描述栏，与上一代一样  
在分类栏选择分类，在MOD列表选择项，鼠标右键进行操作

### 新建分类
在左侧的分类栏中的任意位置单击鼠标右键，选择 `新建` 来新建一个分类  
注意只有一层分类，请合理安排MOD的分类，你可以随时重命名分类

### 新建项
选中一个分类，点击在MOD列表的顶部菜单按钮，选择 `新建项` 来新建一个项  
注意这里是项的概念，整合包中所有MOD都必须是一个单独的项  
切记不可将MOD的非自身内容比如说前置和MOD本身放置在一个项中，否则前置表的功能将无法正常运行  
你可以为每一个项取任何名字，只要你认为你能够记住这一个项是什么就行

### 配置项
然后它会被添加进配置队列，选中该项（如果队列中只有一个项会自动选中那个项，否则自动选中最后一个）  
将文件夹或文件拖拽添加到项中（也就是配置队列窗口的左下角的列表，有右键菜单）  
然后编写安装命令，完成后点击保存即完成配置

这是非常关键的一部分，安装命令详细说明在后面的内容

### 进行安装和卸载
回到主窗口的MOD列表，刷新列表即可看到其状态  
鼠标右键选择安装或卸载操作，程序将按照你编写的安装命令执行

如果条件符合，程序会在你选中项时读取MOD的更新地址和其他基本信息并显示出来

### 自定义项描述和预览图
要为一个项编写自定义描述，请选中该项后清空右侧描述栏中的文本进行编辑文字，默认保存到 TXT 文本文档  
如果你需要保存非纯文本内容（例如图片）请在高级按钮菜单中选择 `保存到 RTF 富文本文档`

要为一个项使用预览图，请选中该项后点击右侧描述栏顶部的`图片`按钮  
将图片放置于程序自动打开的文件夹中，程序会自动选取第一张图片显示在描述栏下方的一块独立的区域中（字母序）  
支持 png、jpg、jpge、bmp、gif

## 整合包验证信息
整合包现在有验证信息这个设定，这些信息加密存储在整合包根目录的无后缀文件中：UI_Manifest 和 UI_System  
请勿更改其中的数据，否则在你重新设定整合包文件夹时，程序解密将失败，你将无法选择该整合包  
这些信息包括你的计算机名称和用户名称，另外包括此整合包的标识字符串（你在创建整合包时填写的标识名称）

这不包含敏感信息，我不会收集它。如果没有密码，它们几乎不可能被破解，但是注意这只是简单的防护  
如果你不小心破坏了这两个加密文件的数据，你可以通过使用 Package Tool V3 应用程序覆盖创建整合包，所有的验证信息将被重写
 
这个设定仅为中国大陆的网络环境设计，在我们这里，很多玩家浏览和下载MOD非常艰难，原因你也知道的，我们有一道墙  
所以为了让更多的人玩到MOD，一些人会制作MOD整合包并公开或非公开地提供给特定的人群  
这在中国大陆以外的地区是非法的，但是在这里的玩家需要这种模式，因为这是大部分人唯一的MOD下载来源  
我不想让我的软件成为传播盗版的一种途径，所以他们至少应该知道自己下载的整合包大概是由谁创建的

## 整合包路径和游戏路径要求
我相信各位都是正版玩家，所以我对游戏路径的限制没有做过多的要求  
+ 只要游戏文件夹路径连上 "\Stardew Valley.exe" 能找到这个游戏主程序文件就行  

整合包路径还是有很强的要求的，首先要避免小白把下载的整合包解压到腾讯QQ的下载目录  
+ 所以其路径不允许包含这些词："Tencent Files"，"FileRecv"，"MobileFile"

其次是验证整合包内容是否正确  
+ 路径分别连上 "\Manifest" 和 "\System" 能正确找到文件  
+ 连上 "\Assets" 能正确找到文件夹

在这一代中我没有再规定整合包不允许放在游戏文件夹，但是我知道总会有小白把整合包放在游戏 Mods 文件夹  
所以我在这里先埋伏他一手，等有小白这么干了就反手来一波官方嘲讽

## 安装命令
安装命令（常简称为：命令）是管理器的核心内容，程序本身并不会做什么  
程序通过用户编写的命令才能知道 MOD 要如何安装以及有没有安装

所有 MOD 就两大类
|  类型  | 传统安装方法 |
|  :----  | :----  |
| SMAPI MOD  | 将 manifest.json 文件所在的文件夹复制到游戏 Mods 文件夹 |
| XNB MOD  | 替换游戏的 xnb 文件 |

安装命令根据这些安装方法设计并扩展使得能够应对各种情况  
如果合理使用，你会发现管理器不仅仅能够管理 MOD，甚至可以做些其他的

### 书写格式
+ 命令是从上到下顺序执行的代码段，命令的参数紧跟着下一行
+ 所有命令都不区分大小写并且就算你多打了空格也可以正常识别
+ 但是参数不可以，因为参数是路径的一部分，所以不允许有任何字符错误
+ 一个命令和另一个命令之间可以空行以帮助增加可读性
+ 但是命令与它的参数之间不允许空行，必须紧挨着下一行

### 文件
+ 安装命令保存于该项目录下的 UI_Code 无后缀文件中
+ 使用 UTF-8 编码（BOM 不影响），使用 CRLF 换行符
+ 不需要手动打开，请在管理器中编辑，程序能自动处理上述要求

### 所有命令
这些表格显示了 SMUI PRO 20 中的所有命令，上一代的字体命令已不再支持
| 动作命令 | 简单描述 |
|  :---- | :----  |
| CDCP | 将文件夹复制到游戏 Mods 文件夹 |
| CDCP-EXP | CDCP 的变体，将文件夹复制到游戏的任意新位置 |
| CDAP | 覆盖游戏 Mods 文件夹中的同名文件夹 |
| CDRF | 替换游戏的单个文件 |
| CDRF-SHA | CDRF 的变体，通过计算 SHA256 来判断是否已安装 |
| CDRF-EXT | CDRF 的变体，只要文件存在就认定已安装 |
| CDVD | 覆盖游戏的 Content 文件夹 |

| 控制命令| 简单描述 |
|  :---- | :----  |
| UN-OFF | 声明禁止执行卸载操作 |

| 条件判断命令 | 简单描述 |
| :----  | :----  |
| RqFolder | 当指定的文件夹存在时才能继续操作 |
| RqFolder-IN | RqFolder 的变体，功能相同，仅在安装时生效 |
| RqFolder-UN | RqFolder 的变体，功能相同，仅在卸载时生效 |
| RqFile | 当指定的文件存在时才能继续操作 |
| RqFile-IN | RqFile 的变体，功能相同，仅在安装时生效 |
| RqFile-UN | RqFile 的变体，功能相同，仅在卸载时生效 |

## 所有命令详细说明 + 举例
注意：程序判断每个项使用哪种安装方法以及有没有安装时只会以第一个动作命令为准  
在有多个动作命令的情况下请合理安排命令顺序，合理的命令顺序往往能带来优质的体验

### CDCP
【作用】将文件夹复制到游戏的 Mods 文件夹，并支持读取清单信息，只要文件夹存在就判定为已安装  
【注意】在使用此命令时文件夹不能套娃，否则程序无法读取文件夹下的 manifest.json 清单文件  
```
CDCP
[参数1：要复制的文件夹，从当前位置算起的相对路径]
```
【举例】**[Content Patcher](https://www.nexusmods.com/stardewvalley/mods/1915)**
```
CDCP
ContentPatcher
```

### CDCP-EXP
【作用】将文件夹复制到游戏文件夹的任何位置，只要文件夹存在就判定为已安装  
这个命令适用于原本游戏没有的文件夹，切勿用于游戏本身就有的文件夹，沙雕后果自负
```
CDCP-EXP
[参数1：要复制的文件夹，从当前位置算起的相对路径]
[参数2：目标文件夹位置，从游戏目录算起的相对路径]
```

### CDAP
【作用】覆盖在 Mods 中已存在的同名文件夹，不支持卸载，无法判断已安装，自动检查是否已经存在要被覆盖的文件夹
```
CDAP
[参数1：被覆盖的同名文件夹，从当前位置算起的相对路径]
```

### CDRF
【作用】将文件复制或替换到游戏文件夹中的任何位置的单个文件，无法判断已安装  
```
CDRF
[参数1：要复制的文件，从当前位置算起的相对路径]
[参数2：目标文件位置，从游戏目录算起的相对路径]
```
【变体】要使 CDRF 实现判断是否已复制或替换文件，请使用它的变体  
**CDRF-SHA**：通过计算文件的 SHA256 效验值来判断是否已安装  
**CDRF-EXT**：只要目标文件存在就判定为已安装

CDRF-EXT 适用于原本游戏没有的文件，切勿用于游戏本身就有的文件，沙雕后果自负

### CDVD
【作用】使用一个 Content 文件夹去覆盖游戏的 Content 文件夹，最适合用来替换一大堆 xnb 文件  
```
CDVD
```
要使用此命令，请创建一个 Content 文件夹，将你要替换的 xnb 文件按照原游戏的相对位置放置，然后在配置项窗口中拖入此文件夹

### UN-OFF
【作用】禁止执行卸载操作，如果你有特殊需求的话。在进行卸载操作时，此命令之后的所有命令都不会被执行
```
UN-OFF
```

### RqFolder
【作用】在游戏文件夹中指定一个文件夹路径，必须存在此文件夹才能继续操作
```
RqFolder
[参数1：指定的文件夹，从游戏目录算起的相对路径]
```
【变体】如果要只在安装或者卸载时才进行检查，请使用它的变体  
**RqFolder-IN**：只在安装时生效  
**RqFolder-UN**：只在卸载时生效  

### RqFile
【作用】在游戏文件夹中指定一个文件路径，必须存在此文件才能继续操作
```
RqFolder
[参数1：指定的文件，从游戏目录算起的相对路径]
```
【变体】如果要只在安装或者卸载时才进行检查，请使用它的变体  
**RqFile-IN**：只在安装时生效  
**RqFile-UN**：只在卸载时生效  

## 文件备份程序
CDRF（含变体） 和 CDVD 支持卸载自动还原，在使用之前你应该提前备份要被替换的文件，否则程序在卸载时直接删除目标文件  
如果文件已经被删了，请通过 Steam 检查文件完整性

从开始菜单或在主程序中“集成的应用”菜单中打开文件备份管理器  
自定义备份规则文件和备份的文件均保存在 C 盘的本地资料夹下（可从内容菜单中打开本地资料夹）  
上一代产品的规则文件可以直接在这一代中使用

要手动管理自定义规则文件，请在本地资料夹的 BackupRules 文件夹中创建任意后缀的文本文档，使用 UTF-8 编码  
在其中输入从游戏目录开始的相对路径，程序会自动识别是文件夹还是文件（文件夹具有优先级别）

## 用户设置文件说明
部分用户设置需要被其他应用程序使用，这部分的设置存放于本地资料夹的 Settings 文件夹中  
警告：切勿直接更改这些文件，否则会破坏其他应用程序的正常运行，当你在主程序中更改设置时程序会自动同步

+ 游戏路径设置：GamePath
+ 整合包路径设置：PackagePath
+ 语言设置：Language
+ 字体设置：Font

## 皮肤功能说明
皮肤是一些特定文件名的 png 图片，作为一些控件的背景图片属性  
皮肤可能导致性能降低和画面闪烁，不推荐单线程性能较低的处理器使用  
使用 PS 或其他专业图片编辑软件处理好图片后将其放入本地资料夹的 SKin 文件夹中

+ 分类栏区域：200x559 像素 MainArea1.png
+ 模组列表区域：682x559 像素 MainArea2.png
+ 前置表区域：682x169 像素 MainArea4.png
+ 正在处理界面上部分：682x75 像素 MainArea5.png
+ 正在处理界面主体部分：682x452 像素 MainArea6.png

## 打包和加载功能说明
要将分类或项分发给其他人使用，请使用打包和加载功能  
在分类栏的菜单中可以打包和加载分类，在模组列表的菜单中可以打包和加载项

+ 分类打包文件：ui3c
+ 项打包文件：ui3m

其本质是 zip 格式的压缩文件，程序会自动压缩数据  
如果你要追求极致压缩以获得尽可能小的打包文件，请在确保对方能够正确放置文件的情况下使用其他压缩软件，例如 7z  
注意：批量打包会在原则上浪费硬盘性能，因为必须先复制到本地资料夹的缓存文件夹，程序会自动清除所有缓存，这点你不必担心
